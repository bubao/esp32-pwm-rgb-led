# RGB LED 控制项目

## 项目简介

该项目基于 ESP32 开发板，通过 PWM 控制 RGB LED 的亮度和颜色变化，并通过按钮实现以下功能：

- 单击按钮：修改 RGB LED 的颜色
- 双击按钮：暂停或恢复 RGB LED 的颜色变化
- 长按按钮：进入 RGB LED 闪烁模式，红、绿、蓝三色依次闪烁。

## 功能特性

1. **PWM 控制**：使用 ESP32 的 LEDC 模块生成 PWM 信号，控制 RGB LED 的亮度。
2. **按钮交互**：
   - 单击按钮：暂停或恢复 RGB LED 的颜色变化。
   - 长按按钮（3 秒）：进入 RGB LED 闪烁模式。
3. **多任务**：通过 FreeRTOS 创建多个任务分别控制红、绿、蓝三色的亮度变化。
4. **信号量与定时器**：使用信号量和定时器实现按钮的单击和长按检测。

## 硬件连接

- **RGB LED 引脚**：
  - 红色通道：GPIO 9
  - 绿色通道：GPIO 10
  - 蓝色通道：GPIO 11
- **按钮引脚**：
  - 按钮：GPIO 0

## 软件依赖

- **ESP-IDF**：ESP32 的官方开发框架。
- **FreeRTOS**：用于任务调度和信号量管理。
- **LEDC 驱动**：用于生成 PWM 信号。

## 文件结构

```tree
├── CMakeLists.txt
├── README.md
├── main
│   ├── CMakeLists.txt
│   └── rgb_led.c
└── sdkconfig
```

## 使用方法

1. **硬件准备**：
   - 按照硬件连接部分连接 RGB LED 和按钮到 ESP32 开发板。

2. **编译与烧录**：
   - 使用 ESP-IDF 工具链编译代码：
     ```bash
     idf.py build
     ```
   - 烧录代码到 ESP32：
     ```bash
     idf.py flash
     ```

3. **运行程序**：
   - 观察 RGB LED 的颜色变化。
   - 按下按钮测试单击、双击和长按功能。

## 代码说明

### 主功能模块

1. **PWM 初始化**：
   - 使用 `ledc_init` 函数配置 PWM 定时器和通道。

2. **按钮中断处理**：
   - 使用 GPIO 中断服务例程 `button_isr_handler` 检测按钮的按下和释放。

3. **长按定时器**：
   - 使用 `xTimerCreate` 创建长按定时器，检测按钮是否被长按超过 3 秒。

4. **任务管理**：
   - 创建三个任务分别控制红、绿、蓝三色的亮度变化。
   - 创建一个任务 `rgb_control_task` 处理按钮交互逻辑。

### 按钮功能逻辑

- **单击**：
  - 暂停或恢复 RGB LED 的颜色变化任务。
- **长按**：
  - 暂停所有颜色变化任务，进入闪烁模式。
  - 再次按下按钮退出闪烁模式，恢复颜色变化任务。

## 注意事项

- 确保硬件连接正确，特别是 RGB LED 和按钮的引脚。
- 如果需要更改引脚定义，请修改代码顶部的宏定义部分。

## 日志输出

程序运行时会通过串口输出日志信息，包括任务状态和按钮交互事件。可以使用以下命令查看日志：

```bash
idf.py monitor
```

## 许可证

本项目基于 MIT 许可证开源，欢迎自由使用和修改。
